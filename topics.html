<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DebateSphere - Topics</title>
    <style>
      /* Global Styles */
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        background: linear-gradient(
          135deg,
          #c7ceea,
          #ffd1dc,
          #fff3cd,
          #d5f5e3
        ); /* Pastel gradient colors */
        background-size: 400% 400%;
        animation: pastel-gradient-animation 15s ease infinite;
        color: #333;
        box-sizing: border-box;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        cursor: none; /* Hide default cursor */
      }
      
      @keyframes pastel-gradient-animation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* Custom Cursor Styles */
      .custom-cursor {
        position: fixed;
        top: 0;
        left: 0;
        width: 10px;
        height: 10px;
        background-color: #000;
        border-radius: 50%;
        pointer-events: none;
        z-index: 9999;
        transform: translate(-50%, -50%);
        transition: width 0.2s ease-out, height 0.2s ease-out,
          background-color 0.2s ease-out;
      }
      
      .custom-cursor.active {
        background-color: #555;
        width: 20px;
        height: 20px;
      }

      /* Header */
      .dashboard-header {
        background-color: rgba(255, 255, 255, 0.7);
        padding: 15px 50px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        backdrop-filter: blur(8px);
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 50;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
      }
      
      .dashboard-header nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .dashboard-header .logo a {
        font-size: 1.8em;
        font-weight: 700;
        color: #6a5acd;
        text-decoration: none;
        transition: color 0.3s ease;
      }
      
      .dashboard-header .logo a:hover {
        color: #8a2be2;
      }
      
      .nav-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
      }
      
      .nav-links li {
        margin-left: 30px;
      }
      
      .nav-links a {
        text-decoration: none;
        color: #555;
        font-weight: 600;
        font-size: 1.1em;
        padding: 8px 15px;
        border-radius: 10px;
        transition: background-color 0.3s ease, color 0.3s ease,
          transform 0.3s ease;
      }
      
      .nav-links a:hover,
      .nav-links a.active {
        background-color: rgba(186, 130, 255, 0.2);
        color: #6a5acd;
        transform: translateY(-3px);
      }

      /* Topics Page Specific Styles */
      .topics-main {
        padding-top: 100px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: calc(100vh - 100px);
        padding-bottom: 50px;
      }
      
      .topics-container {
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 25px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        margin: 20px;
        max-width: 900px;
        width: 100%;
        text-align: center;
        animation: fadeIn 1s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
      }
      
      .topics-container h1 {
        font-size: 2.5em;
        color: #5c4b51;
        margin-bottom: 30px;
        position: relative;
        padding-bottom: 15px;
      }
      
      .topics-container h1::after {
        content: "";
        width: 80px;
        height: 5px;
        background-color: #a3d8f4;
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 2px;
      }

      /* Action Buttons */
      .action-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }
      
      .cta-button {
        display: inline-block;
        background-color: #ffb3d9;
        color: #fff;
        padding: 15px 30px;
        border-radius: 30px;
        text-decoration: none;
        font-size: 1.2em;
        font-weight: 600;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        transition: background-color 0.3s ease, transform 0.3s ease,
          box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
        border: none;
        cursor: pointer;
        min-width: 150px;
      }
      
      .cta-button:hover {
        background-color: #ff8eb8;
        transform: translateY(-7px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
      }
      
      .cta-button.secondary {
        background-color: #a3d8f4;
      }
      
      .cta-button.secondary:hover {
        background-color: #7bc8e8;
      }
      
      .cta-button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      /* Topics List */
      .topics-section {
        margin-top: 40px;
      }
      
      .topics-section h2 {
        font-size: 1.8em;
        color: #6a5acd;
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }
      
      .topics-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .topic-card {
        background-color: #fff;
        border: 2px solid rgba(186, 130, 255, 0.3);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: background-color 0.3s ease, border-color 0.3s ease,
          transform 0.3s ease, box-shadow 0.3s ease;
        text-align: left;
        cursor: pointer;
        position: relative;
      }
      
      .topic-card:hover {
        background-color: rgba(186, 130, 255, 0.1);
        border-color: #6a5acd;
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }
      
      .topic-card.selected {
        background-color: #a3d8f4;
        color: #fff;
        border-color: #a3d8f4;
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(163, 216, 244, 0.4);
      }
      
      .topic-card.loading {
        pointer-events: none;
        opacity: 0.7;
      }
      
      .topic-card.loading::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #6a5acd;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      .topic-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #5c4b51;
        margin-bottom: 10px;
      }
      
      .topic-card.selected .topic-title {
        color: #fff;
      }
      
      .topic-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.9em;
        color: #777;
        margin-bottom: 10px;
      }
      
      .topic-card.selected .topic-meta {
        color: rgba(255, 255, 255, 0.8);
      }
      
      .topic-description {
        font-size: 0.95em;
        color: #666;
        line-height: 1.4;
      }
      
      .topic-card.selected .topic-description {
        color: rgba(255, 255, 255, 0.9);
      }

      /* Loading State */
      .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #6a5acd;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loading-text {
        color: #6a5acd;
        font-size: 1.1em;
        margin-top: 10px;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #777;
      }
      
      .empty-state h3 {
        font-size: 1.5em;
        color: #6a5acd;
        margin-bottom: 15px;
      }
      
      .empty-state p {
        font-size: 1.1em;
        line-height: 1.5;
      }

      /* Toast Notification */
      .toast-notification {
        visibility: hidden;
        min-width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 8px;
        padding: 16px;
        position: fixed;
        z-index: 10000;
        left: 50%;
        transform: translateX(-50%);
        bottom: 30px;
        opacity: 0;
        transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
      
      .toast-notification.show {
        visibility: visible;
        opacity: 1;
        bottom: 50px;
      }
      
      .toast-notification.error {
        background-color: #e74c3c;
      }
      
      .toast-notification.success {
        background-color: #27ae60;
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes slideInFromRight {
        from {
          opacity: 0;
          transform: translateX(50px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .dashboard-header {
          padding: 15px 20px;
          flex-direction: column;
          gap: 15px;
        }
        
        .nav-links {
          flex-direction: column;
          align-items: center;
          gap: 10px;
        }
        
        .nav-links li {
          margin-left: 0;
        }
        
        .topics-main {
          padding-top: 120px;
        }
        
        .topics-container {
          padding: 30px 20px;
          margin: 10px;
        }
        
        .topics-container h1 {
          font-size: 2em;
        }
        
        .action-buttons {
          flex-direction: column;
          align-items: center;
        }
        
        .cta-button {
          font-size: 1em;
          padding: 12px 25px;
          width: 100%;
          max-width: 250px;
        }
        
        .topics-list {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        
        .topic-card {
          padding: 15px;
        }
        
        .topic-title {
          font-size: 1.1em;
        }
      }
    </style>
  </head>
  <body>
    <div class="custom-cursor"></div>
    
    <header class="dashboard-header">
      <nav>
        <div class="logo">
          <a href="dashboard.html">ArguMate</a>
        </div>
        <ul class="nav-links">
          <li><a href="learn.html">Learn</a></li>
          <li><a href="topics.html" class="active">Practice</a></li>
        </ul>
      </nav>
    </header>

    <main class="topics-main">
      <div class="topics-container">
        <h1>Practice Debates</h1>
        
        <div class="action-buttons">
          <button id="restart-btn" class="cta-button" disabled>
            Restart Current Debate
          </button>
          <button id="new-debate-btn" class="cta-button secondary">
            Start New Debate
          </button>
        </div>

        <div class="topics-section">
          <h2>ðŸ“š Available Topics</h2>
          <div id="topics-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading topics...</div>
          </div>
        </div>
      </div>
    </main>

    <div id="toast" class="toast-notification"></div>

    <script>
      // Custom Cursor JavaScript
      const customCursor = document.querySelector(".custom-cursor");
      document.addEventListener("mousemove", (e) => {
        customCursor.style.left = e.clientX + "px";
        customCursor.style.top = e.clientY + "px";
      });
      document.addEventListener("mousedown", () =>
        customCursor.classList.add("active")
      );
      document.addEventListener("mouseup", () =>
        customCursor.classList.remove("active")
      );

      // Topics Page Logic
      document.addEventListener("DOMContentLoaded", () => {
        const restartBtn = document.getElementById("restart-btn");
        const newDebateBtn = document.getElementById("new-debate-btn");
        const topicsContent = document.getElementById("topics-content");
        const toastElement = document.getElementById("toast");
        
        let topics = [];
        let selectedTopic = null;

        // Check if there's an ongoing debate session
        const debateSession = localStorage.getItem('debateSession');
        if (debateSession) {
          restartBtn.disabled = false;
        }

        // Toast notification function
        function showToast(message, type = 'info') {
          toastElement.textContent = message;
          toastElement.className = `toast-notification show ${type}`;
          setTimeout(() => {
            toastElement.classList.remove("show");
          }, 3000);
        }

        // Fetch topics from API
        async function fetchTopics() {
          try {
            const response = await fetch(
              "https://argumate.onrender.com/api/v1/debate/topics",
              {
                method: "GET",
                headers: {
                  "Content-type": "application/json",
                },
                credentials: "include",
              }
            );
            
            const data = await response.json();
            console.log(data);
            
            if (data.success && data.data && data.data.topics) {
              topics = data.data.topics;
              renderTopics();
            } else {
              renderEmptyState();
            }
          } catch (error) {
            console.error("Error fetching topics:", error);
            renderErrorState();
          }
        }

        // Start debate with selected topic
        async function startDebateWithTopic(topic) {
          try {
            const response = await fetch(
              "https://argumate.onrender.com/api/v1/debate/start",
              {
                method: "POST",
                headers: {
                  "Content-type": "application/json",
                },
                credentials: "include",
                body: JSON.stringify({
                  topic: topic.title || topic.topic,
                  level: topic.level || 'intermediate',
                  format: topic.format || 'oxford',
                  role: 'pro' // Default role, can be modified based on requirements
                }),
              }
            );
            
            const data = await response.json();
            console.log("Debate start response:", data);
            
            if (data.success) {
              // Store debate logs in localStorage
              const debateLogs = {
                topic: topic.title || topic.topic,
                level: topic.level || 'intermediate',
                format: topic.format || 'oxford',
                role: 'pro',
                sessionId: data.data?.sessionId || Date.now().toString(),
                startTime: new Date().toISOString(),
                messages: data.data?.messages || []
              };
              
              localStorage.setItem('debateLogs', JSON.stringify(debateLogs));
              localStorage.setItem('debateSession', JSON.stringify(debateLogs));
              
              showToast("Debate started successfully! Redirecting...", "success");
              
              // Navigate to environment page
              setTimeout(() => {
                const url = `environment.html?format=${debateLogs.format}&role=${encodeURIComponent(
                  debateLogs.role
                )}&level=${debateLogs.level}&motion=${encodeURIComponent(debateLogs.topic)}`;
                window.location.href = url;
              }, 2000);
            } else {
              showToast("Failed to start debate. Please try again.", "error");
            }
          } catch (error) {
            console.error("Error starting debate:", error);
            showToast("Error starting debate. Please try again.", "error");
          }
        }

        // Render topics list
        function renderTopics() {
          if (topics.length === 0) {
            renderEmptyState();
            return;
          }

          const topicsHTML = topics.map((topic, index) => `
            <div class="topic-card" data-topic-index="${index}">
              <div class="topic-title">${topic.title || topic.topic || 'Untitled Topic'}</div>
              <div class="topic-meta">
                <span>Level: ${topic.level || 'Not specified'}</span>
                <span>Format: ${topic.format || 'Not specified'}</span>
              </div>
              <div class="topic-description">
                ${topic.description || topic.motion || 'No description available'}
              </div>
            </div>
          `).join('');

          topicsContent.innerHTML = `
            <div class="topics-list">
              ${topicsHTML}
            </div>
          `;

          // Add click handlers to topic cards
          document.querySelectorAll('.topic-card').forEach(card => {
            card.addEventListener('click', async (e) => {
              const topicIndex = parseInt(card.dataset.topicIndex);
              const topic = topics[topicIndex];
              
              // Prevent multiple clicks
              if (card.classList.contains('loading')) {
                return;
              }
              
              // Remove selection from other cards
              document.querySelectorAll('.topic-card').forEach(c => {
                c.classList.remove('selected');
                c.classList.remove('loading');
              });
              
              // Add loading state to current card
              card.classList.add('loading');
              
              try {
                // Start debate with selected topic
                await startDebateWithTopic(topic);
                
              } catch (error) {
                console.error("Error starting debate:", error);
                card.classList.remove('loading');
                showToast("Error starting debate. Please try again.", "error");
              }
            });
          });
        }

        // Render empty state
        function renderEmptyState() {
          topicsContent.innerHTML = `
            <div class="empty-state">
              <h3>No Topics Available</h3>
              <p>There are currently no debate topics available. Please try again later or start a new debate with your own topic.</p>
            </div>
          `;
        }

        // Render error state
        function renderErrorState() {
          topicsContent.innerHTML = `
            <div class="empty-state">
              <h3>Unable to Load Topics</h3>
              <p>There was an error loading the debate topics. Please check your connection and try again.</p>
              <button class="cta-button" onclick="location.reload()">Retry</button>
            </div>
          `;
        }

        // Restart debate handler
        restartBtn.addEventListener("click", async () => {
          try {
            restartBtn.disabled = true;
            restartBtn.textContent = "Restarting...";
            
            // Get existing debate session
            const debateSession = JSON.parse(localStorage.getItem('debateSession') || '{}');
            
            const response = await fetch(
              "https://argumate.onrender.com/api/v1/debate/restart",
              {
                method: "POST",
                headers: {
                  "Content-type": "application/json",
                },
                credentials: "include",
                body: JSON.stringify({
                  topic: debateSession.topic,
                }),
              }
            );
            
            const data = await response.json();
            console.log("Restart response:", data);
            
            if (data.success) {
              // Update debate logs
              const updatedDebateLogs = {
                ...debateSession,
                sessionId: data.data?.sessionId || Date.now().toString(),
                startTime: new Date().toISOString(),
                messages: data.data?.messages || []
              };
              
              localStorage.setItem('debateLogs', JSON.stringify(updatedDebateLogs));
              localStorage.setItem('debateSession', JSON.stringify(updatedDebateLogs));
              
              showToast("Debate restarted successfully! Redirecting...", "success");
              
              setTimeout(() => {
                const url = `environment.html?format=${updatedDebateLogs.format}&role=${encodeURIComponent(
                  updatedDebateLogs.role
                )}&level=${updatedDebateLogs.level}&motion=${encodeURIComponent(updatedDebateLogs.topic)}`;
                window.location.href = url;
              }, 2000);
            } else {
              showToast("Failed to restart debate. Please try again.", "error");
              restartBtn.disabled = false;
              restartBtn.textContent = "Restart Current Debate";
            }
          } catch (error) {
            console.error("Error restarting debate:", error);
            showToast("Error restarting debate. Please try again.", "error");
            restartBtn.disabled = false;
            restartBtn.textContent = "Restart Current Debate";
          }
        });

        // New debate handler
        newDebateBtn.addEventListener("click", () => {
          window.location.href = "practice.html";
        });

        // Initialize page
        fetchTopics();

        // Highlight active navigation link
        const navLinks = document.querySelectorAll(".nav-links a");
        navLinks.forEach((link) => {
          if (link.getAttribute("href") === "topics.html") {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });
      });
    </script>
  </body>
</html>